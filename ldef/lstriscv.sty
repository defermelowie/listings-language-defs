\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{lstriscv}[2023/05/18 Listings language definition for RISC-V assembly]

\RequirePackage{listings}

% Source: https://gist.github.com/AntonLydike/e339c3c3a4dcab8bc3c620b3fa436cda
\lstdefinelanguage[riscv]{Assembly}
{
    alsoletter={.}, % allow dots in keywords
    alsodigit={0x}, % hex numbers are numbers too!
    morekeywords=[1]
    { % instructions
        add, sub, xor, or, and, sll, srl, sra, slt, sltu,
        addi, xori, ori, andi, slli, srli, srai, stli, stliu,
        lb, lh, lw, ld, lbu, lhu,
        sb, sh, sw, sd,
        beq, bne, blt, bge, bltu, bgeu,
        j, jal, jr, jalr, auipc, ret, call, tail
        ecall, break, nop, fence,
        la, li, lui, mv, not, neg, negw, sext.w, seqz, sneq, sltz, sgtz,
        beqz, bnez, blez, bgez, bltz, bgtz, bgt, ble, bgtu, bleu,
        mul, mulh, mulsu, mulu, div, divu, rem, remu,
        lr.w, sc.w, amoswap.w, amoadd.w, amoand.w, amoor.w, amoxor.w, amomax.w, amomin.w,
        flw, fsw, fmadd.s, fmsub.s, fnmadd.s, fnmsub.s, fadd.s, fsub.s, fmul.s, fdiv.s, fsqrt.s,
        fsgnj.s, fsgnjn.s, fsgnjx.s, fmin.s, fmax.s,
        fcvt.s.w, fcvt.s.wu, fcvt.w.s, fcvt.wu.s, fmv.x.w, fmv.w.x,
        feq.s, flt.s, fle.s, fclass.s,
        fmv.s, fabs.s, fneg.s, fmv.d, fabs.d, fneg.d,
        c.lwsp, c.swsp, c.lw, c.sw, c.j, c.jal, c.jr, c.jalr, c.beqz, c.bnez,
        c.li, c.lui, c.addi, c.addi16sp, c.addi4spn,
        c.slli, c.srli, c.srai, c.andi, c.mv, c.add, c.and, c.or, c.xor, c.sub, c.nop, c.ebreak,
        csrrw, csrrs, csrrc, csrrwi, csrr, csrw, csrwi, csrs, csrc,
        mret, sret, uret
        },
    morekeywords=[2]
    { % sections of our code and other directives
        .text, .data, .rodata, .bss, .section,
        .byte, .2byte, .4byte, .8byte, .half, .word, .dword,
        .align, .balign, .p2align,
        .global, .local, .equ,
        .option, .macro, .endm,
    },
    morekeywords=[3]
    { % registers
        zero, ra, sp, gp, tp, s0, fp,
        t0, t1, t2, t3, t4, t5, t6,
        s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11,
        a0, a1, a2, a3, a4, a5, a6, a7,
        ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7,
        fs0, fs1, fs2, fs3, fs4, fs5, fs6, fs7, fs8, fs9, fs10, fs11,
        fa0, fa1, fa2, fa3, fa4, fa5, fa6, fa7
    },
    morekeywords=[4]
    { % command and status registers
        fflags, frm, fcsr,
        cycle, time, instret, hpmcounter3, hpmcounter4, hpmcounter5, hpmcounter6, hpmcounter7,
        hpmcounter8, hpmcounter9, hpmcounter10, hpmcounter11, hpmcounter12, hpmcounter13,
        hpmcounter14, hpmcounter15, hpmcounter16, hpmcounter17, hpmcounter18, hpmcounter19,
        hpmcounter20, hpmcounter21, hpmcounter22, hpmcounter23, hpmcounter24, hpmcounter25,
        hpmcounter26, hpmcounter27, hpmcounter28, hpmcounter29, hpmcounter30, hpmcounter31,
        cycleh, timeh, instreth, hpmcounter3h, hpmcounter4h, hpmcounter5h, hpmcounter6h, hpmcounter7h,
        hpmcounter8h, hpmcounter9h, hpmcounter10h, hpmcounter11h, hpmcounter12h, hpmcounter13h,
        hpmcounter14h, hpmcounter15h, hpmcounter16h, hpmcounter17h, hpmcounter18h, hpmcounter19h,
        hpmcounter20h, hpmcounter21h, hpmcounter22h, hpmcounter23h, hpmcounter24h, hpmcounter25h,
        hpmcounter26h, hpmcounter27h, hpmcounter28h, hpmcounter29h, hpmcounter30h, hpmcounter31h,
        sstatus, sie, stvec, scounteren,
        senvcfg,
        sscratch, sepc, scause, stval, sip,
        satp, scontext,
        hstatus, hedeleg, hideleg, hie, hcounteren, hgeie,
        htval, hip, hvip, htinst, hgeip,
        henvcfg, henvcfgh,
        hgatp, hcontext,
        htimedelta, htimedeltah,
        vsstatus, vsie, vstvec, vsscratch, vsepc, vscause, vstval, vsip, vsatp,
        mvendorid, marchid, mimpid, mhartid, mconfigptr,
        mstatus, misa, medeleg, mideleg, mie, mtvec, mcounteren, mstatush,
        mscratch, mepc, mcause, mtval, mip, mtinst, mtval2,
        menvcfg, menvcfgh, mseccfg, mseccfgh,
        pmpcfg0, pmpcfg1, pmpcfg2, pmpcfg3, % Todo: pmpcfg4-16
        pmpaddr0, pmpaddr1, pmpaddr2, pmpaddr3, pmpaddr4, pmpaddr5, pmpaddr6, pmpaddr7,
        pmpaddr8, pmpaddr9, pmpaddr10, pmpaddr11, pmpaddr12, pmpaddr13, pmpaddr14, pmpaddr15,
        % Todo: pmpaddr16-63
        mnscratch, mnepc, mncause, mnstatus,
        mcycle, minstret, mhpmcounter3, mhpmcounter4, mhpmcounter5, mhpmcounter6, mhpmcounter7,
        mhpmcounter8, mhpmcounter9, mhpmcounter10, mhpmcounter11, mhpmcounter12, mhpmcounter13,
        mhpmcounter14, mhpmcounter15, mhpmcounter16, mhpmcounter17, mhpmcounter18, mhpmcounter19,
        mhpmcounter20, mhpmcounter21, mhpmcounter22, mhpmcounter23, mhpmcounter24, mhpmcounter25,
        mhpmcounter26, mhpmcounter27, mhpmcounter28, mhpmcounter29, mhpmcounter30, mhpmcounter31,
        cycleh, minstreth, mhpmcounter3h, mhpmcounter4h, mhpmcounter5h, mhpmcounter6h, mhpmcounter7h,
        mhpmcounter8h, mhpmcounter9h, mhpmcounter10h, mhpmcounter11h, mhpmcounter12h, mhpmcounter13h,
        mhpmcounter14h, mhpmcounter15h, mhpmcounter16h, mhpmcounter17h, mhpmcounter18h, mhpmcounter19h,
        mhpmcounter20h, mhpmcounter21h, mhpmcounter22h, mhpmcounter23h, mhpmcounter24h, mhpmcounter25h,
        mhpmcounter26h, mhpmcounter27h, mhpmcounter28h, mhpmcounter29h, mhpmcounter30h, mhpmcounter31h,
        mcountinhibit, mhpmevent3, mhpmevent4, mhpmevent5, mhpmevent6, mhpmevent7,
        mhpmevent8, mhpmevent9, mhpmevent10, mhpmevent11, mhpmevent12, mhpmevent13,
        mhpmevent14, mhpmevent15, mhpmevent16, mhpmevent17, mhpmevent18, mhpmevent19,
        mhpmevent20, mhpmevent21, mhpmevent22, mhpmevent23, mhpmevent24, mhpmevent25,
        mhpmevent26, mhpmevent27, mhpmevent28, mhpmevent29, mhpmevent30, mhpmevent31,
        tselect, tdata1, tdata2, tdata3, mcontext,
        dcsr, dpc, dscratch0, dscratch1
    },
    morecomment=[l]{;},   % mark ; as line comment start
    morecomment=[l]{\#},  % also mark # as line comment start
    morestring=[b]",      % mark " as string start/end
    morestring=[b]'       % also mark ' as string start/end
}

% Define code listings style
\lstdefinestyle{riscv}{
    keywordstyle=[1]\bfseries, % Instructions are bold
    keywordstyle=[2]\bfseries, % Directives are bold
    keywordstyle=[3]\mdseries, % Registers are normal
    keywordstyle=[4]\mdseries, % CSRs are normal
}
